! function(e, t) {
  "object" == typeof exports && "undefined" != typeof module ? module.exports = t(require("global/window"), require("global/document"), require("video.js"), require("@brightcove/loscore")) : "function" == typeof define && define.amd ? define(["global/window", "global/document", "video.js", "@brightcove/loscore"], t) : e.videojsPip = t(e.window, e.document, e.videojs, e.videojs.bc_)
}(this, function(e, t, i, s) {
  "use strict";

  function n(e) {
    if(void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    return e
  }
  e = e && e.hasOwnProperty("default") ? e.default : e, t = t && t.hasOwnProperty("default") ? t.default : t, i = i && i.hasOwnProperty("default") ? i.default : i, s = s && s.hasOwnProperty("default") ? s.default : s;
  var o = t.documentElement,
    r = t.body,
    a = function(e) {
      var t, s, n, a, l, h, c, u, p = i.dom.getBoundingClientRect(e),
        d = {
          top: 0,
          left: 0,
          right: o.clientWidth || r.clientWidth,
          width: o.clientWidth || r.clientWidth,
          bottom: o.clientHeight || r.clientHeight,
          height: o.clientHeight || r.clientHeight
        },
        v = (t = d, s = p, n = Math.max(t.top, s.top), a = Math.min(t.bottom, s.bottom), l = Math.max(t.left, s.left), h = Math.min(t.right, s.right), u = a - n, (c = h - l) >= 0 && u >= 0 && {
          top: n,
          bottom: a,
          left: l,
          right: h,
          width: c,
          height: u
        }),
        f = p.width * p.height;
      return f ? v.width * v.height / f : 0
    },
    l = function() {
      function n(t, i, n, o) {
        var r = this;
        this.el_ = t, this.threshold_ = i, this.callback_ = n, this.supportsIO_ = o, this.observing_ = !1, void 0 === o && (this.supportsIO_ = "IntersectionObserver" in e && "IntersectionObserverEntry" in e && "intersectionRatio" in e.IntersectionObserverEntry.prototype), this.supportsIO_ ? this.io_ = new e.IntersectionObserver(function(e) {
          for(var s = 0; s < e.length; s++)
            if(e[s].target === t) return n(e[s].intersectionRatio >= i)
        }, {
          threshold: i
        }) : this.boundCheckForIntersection_ = s.throttle(function(e) {
          return r.checkForIntersection_(e)
        }, 500)
      }
      var o = n.prototype;
      return o.observe = function() {
        this.observing_ || (this.observing_ = !0, this.supportsIO_ ? this.io_.observe(this.el_) : (i.on(e, "resize", this.boundCheckForIntersection_), i.on(t, "scroll", this.boundCheckForIntersection_)))
      }, o.unobserve = function() {
        this.observing_ && (this.observing_ = !1, this.supportsIO_ ? this.io_.unobserve(this.el_) : (i.off(e, "resize", this.boundCheckForIntersection_), i.off(t, "scroll", this.boundCheckForIntersection_)))
      }, o.dispose = function() {
        this.unobserve(), this.io_ = null, this.el_ = null, this.callback_ = null
      }, o.checkForIntersection_ = function() {
        if("none" !== e.getComputedStyle(this.el_).display) {
          var t = a(this.el_);
          this.callback_(t >= this.threshold_)
        }
      }, n
    }(),
    h = i.browser,
    c = h.IS_ANDROID,
    u = h.IS_IOS,
    p = i.getComponent("CloseButton"),
    d = i.getPlugin("plugin"),
    v = "vjs-pip",
    f = v + "-container",
    _ = v + "-active",
    b = v + "-inactive",
    g = v + "-legacy-responsive",
    y = v + "-studio-responsive",
    m = {
      allowOnMobile: !1,
      closeable: !0,
      height: null,
      manualContainerSize: !1,
      posX: "right",
      posY: "bottom",
      scale: 2 / 3,
      useIntersectionObserver_: void 0,
      viewable: .8,
      width: null
    },
    w = ["left", "right"],
    S = ["top", "bottom"],
    C = function(e) {
      return e && "div" === e.tagName.toLowerCase()
    },
    E = function(e) {
      return C(e) && e.hasAttribute("style")
    },
    O = function(e) {
      return C(e) && i.dom.hasClass(e, f)
    },
    I = function(t) {
      var o, r;

      function a(i, s) {
        var o;
        return (o = t.call(this, i) || this).containerEl() ? (o.setOptions(s), o.options.allowOnMobile || !c && !u ? (o.oneWindowScroll_ = o.oneWindowScroll_.bind(n(o)), e.addEventListener("scroll", o.oneWindowScroll_), o.observe_(), i.addClass(v), i.fluid() || o.options.manualContainerSize || (o.setContainerSize_(o.player.currentDimensions()), o.on(i, "playerresize", o.onPlayerResize_)), o.on(i, "fullscreenchange", o.onFullscreenChange_), o.enable(), o) : o.dispose() || n(o)) : o.dispose() || n(o)
      }
      r = t, (o = a).prototype = Object.create(r.prototype), o.prototype.constructor = o, o.__proto__ = r;
      var h = a.prototype;
      return h.setOptions = function(e) {
        var t = void 0 === e ? {} : e,
          n = t.allowOnMobile,
          o = t.closeable,
          r = t.height,
          a = t.manualContainerSize,
          l = t.posX,
          h = t.posY,
          c = t.scale,
          u = t.useIntersectionObserver_,
          p = t.width,
          d = t.viewable;
        s.isObj(this.options) || (this.options = i.mergeOptions(m)), "boolean" == typeof n && (this.options.allowOnMobile = n), this.options.manualContainerSize = "boolean" == typeof a ? a : this.containerEl().hasAttribute("data-manual-container-size"), "boolean" == typeof o && (this.options.closeable = o), (null === r || s.isNum(r)) && (this.options.height = r), (null === p || s.isNum(p)) && (this.options.width = p), s.isNum(c) && c > 0 && c <= 1 && (this.options.scale = c), -1 !== w.indexOf(l) && (this.options.posX = l), -1 !== S.indexOf(h) && (this.options.posY = h), void 0 !== u && (this.options.useIntersectionObserver_ = u), s.isNum(d) && d >= 0 && d <= 1 && (this.options.viewable = d)
      }, h.isLegacyResponsive_ = function() {
        var e = this.player.el().parentElement;
        return !O(e) && E(e) && E(e.parentElement) && O(e.parentElement.parentElement)
      }, h.isStudioResponsive_ = function() {
        var e = this.player.el().parentElement;
        return !O(e) && E(e) && O(e.parentElement)
      }, h.containerEl = function() {
        if(this.containerEl_) return this.containerEl_;
        var e = this.player.el().parentElement;
        if(this.isStudioResponsive_() ? (e = e.parentElement, i.dom.addClass(e, y), this.setState({
            studioResponsive: !0
          })) : this.isLegacyResponsive_() && (e = e.parentElement.parentElement, i.dom.addClass(e, g), this.setState({
            legacyResponsive: !0
          })), i.dom.hasClass(e, f)) return e;
        i.log.warn('expected player to be a child of a "' + f + '" element, cannot continue with picture-in-picture plugin')
      }, h.enable = function() {
        this.state.enabled || (this.player.trigger("beforepipenabled"), this.setState({
          enabled: !0
        }), this.observe_(), this.player.trigger("pipenabled"))
      }, h.disable = function() {
        this.state.enabled && (this.player.trigger("beforepipdisabled"), this.state.active && this.deactivate(), this.setState({
          enabled: !1
        }), this.unobserve_(), this.player.trigger("pipdisabled"))
      }, h.activate = function() {
        var e = this.player;
        this.state.enabled && !this.state.active && this.state.haveSeenScroll && e.hasStarted() && (this.storeBeforeActiveState_(), e.trigger("beforepipactive"), this.setState({
          active: !0
        }), this.setContainerSize_(), this.scalePlayer_(), this.addCloseButton_(), e.fluid(!1), this.setActiveClasses_(), this.observe_(), e.trigger("pipactive"))
      }, h.deactivate = function() {
        var e = this.player;
        this.state.enabled && this.state.active && (e.trigger("beforepipinactive"), this.unsetContainerSize_(), this.restorePlayer_(), this.removeCloseButton_(), this.beforeActiveState_.wasFluid_ && e.fluid(!0), this.setInactiveClasses_(), this.setState({
          active: !1
        }), e.trigger("pipinactive"))
      }, h.toggle = function() {
        this.state.active ? this.deactivate() : this.activate()
      }, h.observe_ = function() {
        var e = this,
          t = this.options,
          i = this.player,
          s = this.state.active ? this.containerEl() : i.el();
        this.vo_ && this.vo_.el_ !== s && (this.vo_.dispose(), this.vo_ = null), this.vo_ || (this.vo_ = new l(s, t.viewable, function(t) {
          return e.onViewableChange_(t)
        }, t.useIntersectionObserver_)), this.vo_.observe()
      }, h.unobserve_ = function() {
        this.vo_ && this.vo_.unobserve()
      }, h.storeBeforeActiveState_ = function() {
        var e = this.options,
          t = this.player,
          i = this.state;
        if(!i.isFullscreen) {
          var s = this.beforeActiveState_ = {
            activeClasses: [_, v + "-x-" + e.posX, v + "-y-" + e.posY],
            inactiveClasses: [b],
            playerDimensions: t.currentDimensions(),
            wasFluid_: t.fluid()
          };
          if(["vjs-16-9", "vjs-4-3", "vjs-fill"].forEach(function(e) {
              t.hasClass(e) && s.inactiveClasses.push(e)
            }), !e.manualContainerSize) {
            var n = this.containerEl().style;
            s.containerDimensions = {
              height: n.height,
              width: n.width
            }
          }
          if(i.legacyResponsive) {
            var o = t.el().style;
            s.playerStyle = {
              height: o.height,
              width: o.width
            }
          }
        }
      }, h.clearBeforeActiveState_ = function() {
        this.beforeActiveState_ = null
      }, h.setContainerSize_ = function(e) {
        if(void 0 === e && (e = this.beforeActiveState_.playerDimensions), !this.options.manualContainerSize) {
          var t = this.containerEl().style;
          ["height", "width"].forEach(function(i) {
            s.isNum(e[i]) ? t[i] = e[i] + "px" : t[i] = null
          })
        }
      }, h.unsetContainerSize_ = function() {
        if(!this.options.manualContainerSize) {
          var e = this.beforeActiveState_.containerDimensions,
            t = this.containerEl().style;
          t.height = e.height, t.width = e.width
        }
      }, h.scalePlayer_ = function() {
        var e = this.options,
          t = this.player,
          i = this.state,
          n = e.height,
          o = e.scale,
          r = e.width,
          a = s.isNum(n),
          l = s.isNum(r),
          h = this.beforeActiveState_.playerDimensions;
        if(a || l) {
          var c = h.width / h.height;
          a || (n = r / c), l || (r = n * c)
        } else n = Math.round(h.height * o), r = Math.round(h.width * o);
        if(i.legacyResponsive) {
          var u = t.el().style;
          u.height = n + "px", u.width = r + "px"
        } else t.dimension("height", n), t.dimension("width", r)
      }, h.restorePlayer_ = function() {
        var e = this.player,
          t = this.state,
          i = e.el().style,
          s = this.beforeActiveState_,
          n = s.playerDimensions,
          o = s.playerStyle;
        t.legacyResponsive ? (i.height = o.height, i.width = o.width) : t.studioResponsive ? (i.height = "", i.width = "") : e.dimensions(n.width, n.height)
      }, h.addCloseButton_ = function() {
        var e = this;
        if(this.options.closeable) {
          var t = this.player,
            i = this.closeButton_ = new p(t);
          i.addClass("vjs-pip-close-button"), i.on("close", function() {
            t.trigger("beforepipclose"), t.pause(), e.disable(), t.trigger("pipclose")
          }), t.addChild(i)
        }
      }, h.removeCloseButton_ = function() {
        this.closeButton_ && (this.closeButton_.dispose(), this.closeButton_ = null)
      }, h.setActiveClasses_ = function() {
        var e = this.player,
          t = this.beforeActiveState_,
          i = t.activeClasses,
          s = t.inactiveClasses;
        i.forEach(function(t) {
          return e.addClass(t)
        }), s.forEach(function(t) {
          return e.removeClass(t)
        })
      }, h.setInactiveClasses_ = function() {
        var e = this.player,
          t = this.beforeActiveState_,
          i = t.activeClasses,
          s = t.inactiveClasses;
        i.forEach(function(t) {
          return e.removeClass(t)
        }), s.forEach(function(t) {
          return e.addClass(t)
        })
      }, h.onViewableChange_ = function(e) {
        this.setState({
          viewable: e
        }), e ? this.deactivate() : this.activate()
      }, h.onPlayerResize_ = function() {
        this.player.fluid() || this.state.active || this.options.manualContainerSize || this.setContainerSize_(this.player.currentDimensions())
      }, h.oneWindowScroll_ = function() {
        e.removeEventListener("scroll", this.oneWindowScroll_), this.setState({
          haveSeenScroll: !0
        })
      }, h.onFullscreenChange_ = function() {
        this.setState({
          isFullscreen: !this.state.isFullscreen
        }), this.state.isFullscreen && (this.setState({
          haveSeenScroll: !1
        }), e.addEventListener("scroll", this.oneWindowScroll_))
      }, h.dispose = function() {
        this.state.active && this.deactivate(), this.disable(), e.removeEventListener("scroll", this.oneWindowScroll_), t.prototype.dispose.call(this)
      }, a
    }(d);
  return I.defaultState = {
    active: !1,
    enabled: !1,
    haveSeenScroll: !1,
    legacyResponsive: !1,
    viewable: !1,
    isFullscreen: !1
  }, I.VERSION = "1.1.4", i.registerPlugin("pip", I), I
});

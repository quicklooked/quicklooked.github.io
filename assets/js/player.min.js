var player = document.querySelector(".player");
var play = document.querySelector(".play");
var video = document.getElementById("quickplayer");
var vp_controls = document.querySelector(".vp-controls");
var vp_preview = document.querySelector(".vp-preview");
var vp_spin = document.querySelector(".vp-spin");
var vp_menu = document.querySelector('div[role="menu"]');
var vp_prefs = document.querySelector(".vp-prefs");
var vp_quality = document.querySelector(".vp--quality");
var vp_speed = document.querySelector(".vp--speed");
var full_screen = document.querySelector(".fullscreenvideo");

this.openFullscreen = function () {
  if (video.requestFullScreen) {
    video.requestFullScreen();
  } else if (video.mozRequestFullScreen) {
    video.mozRequestFullScreen();
  } else if (video.webkitRequestFullScreen) {
    video.webkitRequestFullScreen();
  }
  this.fullscreen = true;
};

this.closeFullscreen = function () {
  if (document.cancelFullScreen) {
    document.cancelFullScreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.webkitCancelFullScreen) {
    document.webkitCancelFullScreen();
  }
  this.fullscreen = false;
};

var toggleFullscreen = function (event) {
  event.preventDefault();
  if (!this.fullscreen) {
    this.openFullscreen();
  } else {
    this.closeFullscreen();
  }
  return false;
}.bind(this);

function loadStart() {
  vp_spin.classList.remove("vp-spin-invisible");
}

function canPlay() {
  vp_spin.classList.add("vp-spin-invisible");
}

function videoplay() {
  if (video.paused) {
    video.play();
    vp_controls.classList.remove("controls-outro");
    play.classList.remove("state-paused");
    vp_preview.classList.toggle("vp-preview-invisible");
    play.classList.toggle("state-playing");
  } else {
    video.pause();
    play.classList.remove("state-playing");
    vp_preview.classList.toggle("vp-preview-invisible");
    play.classList.toggle("state-paused");
  }
}

function videoended() {
  vp_preview.classList.toggle("vp-preview-invisible");
  play.classList.remove("state-playing");
  play.classList.toggle("state-paused");
  vp_controls.classList.toggle("controls-outro");
}

function openMenu() {
  if (vp_prefs.attributes["aria-expanded"].value == "false") {
    vp_menu.classList.remove("vp-menu-invisible");
    vp_menu.classList.remove("vp-menu-hidden");
    vp_quality.classList.remove("vp-panel-open");
    vp_speed.classList.remove("vp-panel-open");
    vp_prefs.ariaExpanded = "true";
  } else {
    vp_menu.classList.add("vp-menu-invisible");
    vp_menu.classList.add("vp-menu-hidden");
    vp_quality.classList.remove("vp-panel-open");
    vp_speed.classList.remove("vp-panel-open");
    vp_prefs.ariaExpanded = "false";
  }
}

function vpQuality() {
  if (vp_quality.attributes["aria-hidden"].value == "true") {
    vp_quality.classList.add("vp-panel-open");
    vp_quality.ariaHidden = "false";
  } else {
    vp_quality.classList.remove("vp-panel-open");
    vp_quality.ariaHidden = "true";
  }
}

function vpSpeed() {
  if (vp_speed.attributes["aria-hidden"].value == "true") {
    vp_speed.classList.add("vp-panel-open");
    vp_speed.ariaHidden = "false";
  } else {
    vp_speed.classList.remove("vp-panel-open");
    vp_speed.ariaHidden = "true";
  }
}

play.addEventListener("click", videoplay, false);
video.addEventListener("click", videoplay, false);
video.addEventListener("ended", videoended, false);
video.addEventListener("loadstart", loadStart, false);
video.addEventListener("canplay", canPlay, false);
vp_prefs.addEventListener("click", openMenu, false);
vp_quality.addEventListener("click", vpQuality, false);
vp_speed.addEventListener("click", vpSpeed, false);
full_screen.addEventListener("click", toggleFullscreen, false);

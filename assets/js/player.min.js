var player = document.querySelector(".player");
var play = document.querySelector(".play");
var video = document.getElementById("quickplayer");
var vp_controls = document.querySelector(".vp-controls");
var vp_preview = document.querySelector(".vp-preview");
var vp_outro_wrapper = document.querySelector(".vp-outro-wrapper");
var vp_spin = document.querySelector(".vp-spin");
var vp_menu = document.querySelector('div[role="menu"]');
var captions = document.querySelector('div[role="menucaptions"]');
var cc = document.querySelector(".cc");
var vp_prefs = document.querySelector(".vp-prefs");
var vp_quality = document.querySelector(".vp--quality");
var vp_speed = document.querySelector(".vp--speed");
var full_screen = document.querySelector(".fullscreenvideo");

this.openFullscreen = function () {
  if (video.requestFullScreen) {
    video.requestFullScreen();
  } else if (video.mozRequestFullScreen) {
    video.mozRequestFullScreen();
  } else if (video.webkitRequestFullScreen) {
    video.webkitRequestFullScreen();
  }
  this.fullscreen = true;
};

this.closeFullscreen = function () {
  if (document.cancelFullScreen) {
    document.cancelFullScreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.webkitCancelFullScreen) {
    document.webkitCancelFullScreen();
  }
  this.fullscreen = false;
};

var toggleFullscreen = function (event) {
  event.preventDefault();
  if (!this.fullscreen) {
    this.openFullscreen();
  } else {
    this.closeFullscreen();
  }
  return false;
}.bind(this);

function loadStart() {
  vp_spin.classList.remove("vp-spin-invisible");
}

function canPlay() {
  vp_spin.classList.add("vp-spin-invisible");
}

function videoplay() {
  vp_preview.classList.add("vp-preview-invisible");
  vp_controls.classList.remove("controls-outro");
  player.classList.remove("player-outroVisible");
  if (video.paused) {
    vp_outro_wrapper.classList.remove("in");
    play.classList.remove("state-paused");
    play.classList.toggle("state-playing");
    video.play();
  } else {
    play.classList.remove("state-playing");
    play.classList.toggle("state-paused");
    video.pause();
  }
}

function videoended() {
  vp_outro_wrapper.classList.toggle("in");
  vp_preview.classList.add("vp-preview-invisible");
  play.classList.remove("state-playing");
  play.classList.toggle("state-paused");
  vp_controls.classList.toggle("controls-outro");
  player.classList.toggle("player-outroVisible");
}

function openCaptions() {
  if (cc.attributes["aria-haspopup"].value == "false") {
    cc.classList.remove("off");
    cc.classList.add("on");
    captions.classList.remove("vp-menu-invisible");
    captions.classList.remove("vp-menu-hidden");
    cc.ariaHasPopup = "true";
  } else {
    cc.classList.remove("on");
    cc.classList.add("off");
    captions.classList.add("vp-menu-invisible");
    captions.classList.add("vp-menu-hidden");
    cc.ariaHasPopup = "false";
  }
}

function openMenu() {
  if (vp_prefs.attributes["aria-haspopup"].value == "false") {
    vp_menu.classList.remove("vp-menu-invisible");
    vp_menu.classList.remove("vp-menu-hidden");
    vp_quality.classList.remove("vp-panel-open");
    vp_speed.classList.remove("vp-panel-open");
    vp_prefs.ariaHasPopup = "true";
  } else {
    vp_menu.classList.add("vp-menu-invisible");
    vp_menu.classList.add("vp-menu-hidden");
    vp_quality.classList.remove("vp-panel-open");
    vp_speed.classList.remove("vp-panel-open");
    vp_prefs.ariaHasPopup = "false";
  }
}

function vpQuality() {
  if (vp_quality.attributes["aria-hidden"].value == "true") {
    vp_quality.classList.add("vp-panel-open");
    vp_quality.ariaHidden = "false";
  } else {
    vp_quality.classList.remove("vp-panel-open");
    vp_quality.ariaHidden = "true";
  }
}

function vpSpeed() {
  if (vp_speed.attributes["aria-hidden"].value == "true") {
    vp_speed.classList.add("vp-panel-open");
    vp_speed.ariaHidden = "false";
  } else {
    vp_speed.classList.remove("vp-panel-open");
    vp_speed.ariaHidden = "true";
  }
}

play.addEventListener("click", videoplay, false);
video.addEventListener("click", videoplay, false);
video.addEventListener("ended", videoended, false);
video.addEventListener("loadstart", loadStart, false);
video.addEventListener("waiting", loadStart, false);
video.addEventListener("canplay", canPlay, false);
vp_prefs.addEventListener("click", openMenu, false);
cc.addEventListener("click", openCaptions, false);
vp_quality.addEventListener("click", vpQuality, false);
vp_speed.addEventListener("click", vpSpeed, false);
full_screen.addEventListener("click", toggleFullscreen, false);

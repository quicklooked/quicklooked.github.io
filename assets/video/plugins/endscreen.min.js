!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((n="undefined"!=typeof globalThis?globalThis:n||self).flowplayer=n.flowplayer||{},n.flowplayer.endscreen=t())}(this,(function(){"use strict";var n="playlist:ended";function t(n){return"function"==typeof n}function e(){throw new Error("Function was expected as Argument[0]")}var r=[].slice;function i(n){if(!(this instanceof i))return new i(n);var o=this;return o.data=n,o.tap=function(){var n=r.call(arguments),a=n.shift();return a==i.lift?o.data:t(a)?(a.apply(o,[o.data].concat(n)),o):void e()},o.into=o.fmap=function(){var n=r.call(arguments),a=n.shift();return a==i.lift?o.data:t(a)?i(a.apply(o,[o.data].concat(n))):void e()},o.unwrap=function(){return o.data},o}function o(n,t){if(1!=!!t)throw new Error(n)}function a(n){return"invalid recommendations configuration\ndetails: "+n+"\n\tmust match Object of shape:\n"+["\t\t{ playlist:  PlaylistId|Array(MediaId|PlayerConfig)"].join("\n\t\t, ")+"\n\t\t}"}function s(n,t){i.of(n).fmap(a).fmap(o,t)}function f(n){return void 0!==n}function u(n){return"string"==typeof n}function c(n){return"object"==typeof n}function l(n){var t;s("Config must be an Object",f(n)&&c(n)),s("property `playlist` is required",f(n.playlist)),s("property `playlist` was not an array nor playlist id",(t=n.playlist,s("playlist property was not of type PlaylistId|Array(MediaId|PlayerConfig)",Array.isArray(t)),!t.forEach((function(n,t){s("item at playlist["+t+"] was not valid",u(n)||c(n))}))))}i.of=i,i.lift=function(n){return n instanceof i?n.data:n},i._apply=i.apply=function(n,t){if(0==t.length)return n();if(1==t.length)return n(t[0]);if(2==t.length)return n(t[0],t[1]);if(3==t.length)return n(t[0],t[1],t[2]);if(4==t.length)return n(t[0],t[1],t[2],t[3]);if(5==t.length)return n(t[0],t[1],t[2],t[3],t[4]);throw new Error("Pipe._apply() does not support arity > 5")},i.maybe=function(n,t,e){return n?i._apply(t,[n].concat(r.call(arguments,2,arguments.length))):n},i.curry=function(n,t,e){return(t=t||[]).length>n.length-1?n.apply(e,t):function(){var o=t.concat(r.call(arguments));return i.curry(n,o,e)}};const d=[].slice;function p(n,t,e){const r=function(n){return Array.isArray(n)?n.slice(0):n.split(".")}(t);for(;r.length;){if(null==n)return e;const t=r.shift();if("string"!=typeof t)return e;n=n[t]}return null==n?e:n}const y=!!function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(n){}return n}()&&{passive:!0},m=["touchstart","touchmove"];function v(n){var t=n;return t.emit=function(n,e,r={}){const i=function(n){const t=document.createEvent("Event");return t.initEvent(n,!1,!0),t}(n);return e&&function(n,t,...e){for(const e in t)n[e]=t[e]}(i,{data:e||{}}),t.dispatchEvent(i),!1===r.return_self?i:t},t.on=function(n,e){return"string"==typeof n&&(n=n.split(" ")),n.forEach((function(n){return function(n){return~m.indexOf(n)}(n)?t.addEventListener(n,e,y):t.addEventListener(n,e)})),t},t.off=function(n,e){return t.removeEventListener(n,e),t},t.one=t.once=function(n,e){return t.on(n,(function r(i){t.off(n,r),e(i)}))},t}const h=Array.isArray,g="undefined"!=typeof window&&v(window),w="undefined"!=typeof document&&v(document),E=["span","a","em","p","i"];function b(n,t,e){var r=C(document.createElement(n));if(h(t)&&(e=t,t=!1),e||(e=[]),e&&!h(e)&&(e=[e]),e.length&&e.filter(n=>!!n).forEach(n=>r.append(n)),"object"!=typeof t)return r;for(var i in t)i in r?r[i]=t[i]:r.setAttribute(i,t[i]);return r}function A(n){var t=n.tagName;n.__flowplayer__=1,n.find=function(t){var e=n.querySelector(t);return e?C(e):e},n.html=function(t){return n.innerHTML=t,n},n.empty=function(){return n.innerHTML="",n},n.offset=function(){var t={top:0,left:0},e=n;do{t.left+=e.offsetLeft||0,t.top+=e.offsetTop||0}while(e=e.offsetParent);return t},n.innerWidth=function(){var t=getComputedStyle(n);return n.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)};var e=n.insert=function(t,e){return e?h(e)?e.map((function(e){return n.insert(t,e)}))[0]:C(e="string"==typeof e?n.insertAdjacentHTML(t,e):n.insertAdjacentElement?n.insertAdjacentElement(t,e):n.appendChild(e)):e};return n.append=e.bind(n,"beforeend"),n.prepend=e.bind(n,"afterbegin"),n.css=function(t,e){if("object"==typeof t){for(const e in t)n.css(e,t[e]);return n}return void 0===e&&"string"==typeof t?getComputedStyle(n)[t]:("number"==typeof e&&(e+="px"),n.style[t]=e,n)},n.show=function(){return n.css({display:~E.indexOf(t)?"inline":"block"})},n.hide=function(){return n.css({display:"none"})},n.remove=function(){var t=n.parentNode;t&&t.removeChild(n)},n.attr=function(t,e){return null==e?n.getAttribute(t):(n.setAttribute(t,e),n)},n.txt=function(t){return n.textContent=t,n},n.fp=function(t){return n.addClass("fp-"+t)},n.addClass=function(t){return t.split(" ").forEach((function(t){n.hasClass(t)||(n.className+=(n.className?" ":"")+t)})),n},n.removeClass=function(t){const e=t.split(" ");var r=n.className.split(" ");return n.className=r.filter((function(n){return!~e.indexOf(n)})).join(" "),n},n.toggleClass=function(t,e){return void 0===e&&(e=!n.hasClass(t)),e?n.addClass(t):n.removeClass(t)},n.findAll=function(t){return e=n.querySelectorAll(t),d.call(e);var e},n.hasClass=function(t){return~n.className.split(" ").indexOf(t)},n}function C(n){return void 0===n||function(n){return n&&n.__flowplayer__}(n)?n:A(v(n))}function x(n,t){if("string"==typeof n&&"<"==n[0])return b(n.slice(1,-1),t);if("string"!=typeof n)return C(n);var e=t instanceof HTMLElement&&t.querySelector(".fp-"+n)||document.querySelector(n);return e?C(e):void 0}const _=n=>(t,e)=>("string"==typeof t&&(t={class:t}),b(n,t,e));function j(n,t){var e=function(n,t){var e=x.div({class:"fp-endscreen-cell-thumbnail",onclick:j.onclick.bind(null,n,t)});n.poster&&(e.style.backgroundImage=["url(",n.poster,")"].join(""));return e}(n,t);return e.append(function(n){var t=n.title||"";return x.div("fp-endscreen-cell-title",t)}(n)),e}function O(n){return t=>{setTimeout((function(){if(!t.defaultPrevented)return n(t)}),0)}}Object.assign(x,{div:_("div"),img:_("img"),li:_("li"),ol:_("ol"),span:_("span"),p:_("p"),i:_("i"),a:_("a"),el:b,document:w,window:g}),j.onclick=function(n,t){"object"==typeof n&&t.setOpts(n),function(n,t,e){if(n.setSrc(u(t)?t:t.src),p(e,"should_play",!1))n.play()}(t,n,{should_play:!0})};function N(t,e,r){var i=x.div("fp-endscreen");r.reaper.put("endscreen",i),r.on("mount",(function(){r.root.middle.append(i)})),r.on("recommendationsready",(function(n){var e=n.data;l(e),i.recommendations=e,!r.ended||r.playlist||t.loop||r.emit("recommendations:render")})),r.on(["ended",n],O((function(n){"ended"==n.type&&r.playlist||i.recommendations&&(t.loop||r.emit("recommendations:render"))}))),r.on(["loadstart","playing"],(function(){r.emit("recommendations:hide")})),r.on("recommendations:hide",O((function(){r.setState("is-endscreen",!1)}))),r.on("recommendations:render",O((function(){!function(n,t,e){t.empty();var r=t.recommendations;if(!r.playlist||0===r.playlist.length)return;var i=n.hasClass("is-small")||n.hasClass("is-tiny")?6:12,o=[];if(r.playlist.forEach((function(n,t){o.length!==i&&n.poster&&n.title&&o.push(x.div("fp-endscreen-cell",new j(n,e,t)))})),0===o.length)return;t.append(x.div("fp-endscreen-cells",o))}(e,i,r),r.setState("is-endscreen",!0)})))}return N.events={RECOMMENDATIONS_RENDER:"recommendations:render",RECOMMENDATIONS_READY:"recommendationsready",RECOMMENDATIONS_HIDE:"recommendations:hide"},function(n,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in n||(n.flowplayer={extensions:[]});var e=n.flowplayer;"function"==typeof e?e(t):(Array.isArray(e.extensions)||(e.extensions=[]),~e.extensions.indexOf(t)||e.extensions.push(t))}(window,N),N}));

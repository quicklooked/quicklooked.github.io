!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.chromecast=t())}(this,(function(){"use strict";const e=[].slice;function t(e,t,n){const r=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(t);for(;r.length;){if(null==e)return n;const t=r.shift();if("string"!=typeof t)return n;e=e[t]}return null==e?n:e}function n(e){var t=document.createElement("a");t.href=e;var n=t.pathname&&t.pathname.split(".");return n.length>1&&n[n.length-1]}function r(e){switch(e){case"video/mpd":return"application/dash+xml";case"video/m3u8":return"application/x-mpegurl";default:return e}}const a=e=>{var{src:t}=e,a=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["src"]);return[Object.assign({src:t,type:t?r("video/"+n(t)):""},a)]};function o(e){const[t,n]=e.split("{");return n?(o=t,n.slice(0,-1).split(",").map((function(e){return{src:o+e,type:r("video/"+e)}}))):a({src:e});var o}function i(e){return"function"==typeof e}function c(){throw new Error("Function was expected as Argument[0]")}var s=[].slice;function u(e){if(!(this instanceof u))return new u(e);var t=this;return t.data=e,t.tap=function(){var e=s.call(arguments),n=e.shift();return n==u.lift?t.data:i(n)?(n.apply(t,[t.data].concat(e)),t):void c()},t.into=t.fmap=function(){var e=s.call(arguments),n=e.shift();return n==u.lift?t.data:i(n)?u(n.apply(t,[t.data].concat(e))):void c()},t.unwrap=function(){return t.data},t}u.of=u,u.lift=function(e){return e instanceof u?e.data:e},u._apply=u.apply=function(e,t){if(0==t.length)return e();if(1==t.length)return e(t[0]);if(2==t.length)return e(t[0],t[1]);if(3==t.length)return e(t[0],t[1],t[2]);if(4==t.length)return e(t[0],t[1],t[2],t[3]);if(5==t.length)return e(t[0],t[1],t[2],t[3],t[4]);throw new Error("Pipe._apply() does not support arity > 5")},u.maybe=function(e,t,n){return e?u._apply(t,[e].concat(s.call(arguments,2,arguments.length))):e},u.curry=function(e,t,n){return(t=t||[]).length>e.length-1?e.apply(n,t):function(){var r=t.concat(s.call(arguments));return u.curry(e,r,n)}};var f="chromecast:idle",l=Object.freeze({__proto__:null,CAST_AVAILABLE:"chromecast:available",CAST_UNAVAILABLE:"chromecast:unavailable",CAST_START_CASTING:"chromecast:start",CAST_IDLE:f,CAST_STATE_CHANGED:"chromecast:state:changed",CAST_SESSION_CHANGED:"chromecast:session:changed",CAST_FIELD_UPDATE:"chromecast:field:update",CAST_MEDIA_LOAD_REQUEST:"chromecast:media"}),p=/(video\/mp4)|(application\/x-mpegurl)|(video\/mpd)|(application\/dash\+xml)/;function d(){return E().fmap(u.maybe,(function(e){return e.getCurrentSession()}))}function m(e){return g(e).fmap(u.maybe,(function(e){return e.shift()}))}function y(){return d().fmap(u.maybe,(function(e){return e.getMediaSession()}))}function v(e){const n=g(e).unwrap().map((function(e){return t(e,"src")}));return y().fmap(u.maybe,t,"media.contentId").fmap(u.maybe,(function(e){return!!~n.indexOf(e)})).unwrap()}function h(e){return t(e,"type","").toString().match(p)}function g(e){return u.of(e).fmap(t,"original_src",[]).fmap((function(e){return"string"==typeof e?o(e):e})).fmap((function(e){return e.map((function(e){return"string"==typeof e?o(e):e}))})).fmap((function(e){return[].concat.apply([],e)})).fmap((function(e){return e.filter(h)}))}function E(){return u.of(window).fmap(t,"cast.framework.CastContext").fmap(u.maybe,(function(e){return e.getInstance()}))}function w(){return t(window,"flowplayer.instances",[])}function S(){return w().filter((function(e){return v(e)}))}function T(){return w().filter((function(e){return!v(e)}))}function _(e,t){S().forEach((function(n){n.emit(e,t)}))}function b(e,t){T().forEach((function(n){n.emit(e,t)}))}function A(e,t){w().forEach((function(n){n.emit(e,t)}))}var C={PAUSED:"isPaused",CURRENT_TIME:"currentTime",DURATION:"duration",CONNECTED:"isConnected",PLAYER_STATE:"playerState",SAVED_STATE:"savedPlayerState",DISPLAY_NAME:"displayName",STATUS:"statusText"},O={player:void 0,controller:void 0};function L(){O.player=new cast.framework.RemotePlayer,O.controller=new cast.framework.RemotePlayerController(O.player),O.controller.addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,N),O.controller.addEventListener(cast.framework.RemotePlayerEventType.MEDIA_INFO_CHANGED,(function(){b(f)}))}function N(e){_("chromecast:field:update",e)}function k(e){var n=[].slice.call(e.querySelectorAll("track")),r=t(e,"hls.subtitleTracks",[]);return[].concat.apply([],n,r).filter((function(e){return"string"==typeof e.lang}))}function I(e){return k(e).map((function(e,t){var n=new chrome.cast.media.Track(t,chrome.cast.media.TrackType.TEXT);return n.trackContentType="text/vtt",n.subtype=chrome.cast.media.TextTrackType.SUBTITLES,n.trackContentId=e.src||e.url,n.name=e.label||e.name,n.language=e.lang,n}))}function x(e){y().fmap(u.maybe,(function(t){var n=new chrome.cast.media.EditTracksInfoRequest(e);t.editTracksInfo(n,console.debug,console.error)}))}var D=Object.freeze({__proto__:null,getCurrentSession:d,getMedia:m,getMediaSession:y,isSame:v,is_supported_media:h,normalizeSrc:g,getCastContext:E,players:w,casting_players:S,idle_players:T,broadcast_to_active:_,broadcast_to_idle:b,broadcast:A,FIELDS:C,SINGLETONS:O,refresh_singletons:L,onremotechange:N,tracks:k,cast_tracks:I,editTracks:x});function j(e,n,r){d().fmap(u.maybe,(function(n){var a=m(e).unwrap();if(a){var o=new chrome.cast.media.MediaInfo(a.src,a.type);o.tracks=I(e),o.metadata=new chrome.cast.media.GenericMediaMetadata;var i=new chrome.cast.media.LoadRequest(o);isNaN(e.currentTime)||(i.currentTime=e.currentTime),o.tracks.length&&(i.activeTrackIds=k(e).filter((function(e){return"showing"==t(e,"track.mode",e.mode)})).map((function(e,t){return t}))),i.customData=t(e,"opts.chromecast",{}),i.customData.metadata=e.opts.metadata,e.emit("chromecast:media",{request:i}),console.debug("cast:request(%o)",i),n.loadMedia(i).then((function(){HTMLMediaElement.prototype.pause.call(e),L(),b(f)}),r)}}))}function P(){return!!y().unwrap()}function M(){return!!d().unwrap()}function R(){return y().fmap(u.maybe,t,"media.duration").unwrap()}function H(){return y().fmap(u.maybe,t,"playerState").unwrap()}function U(e){return e?q(e):y().fmap(u.maybe,(function(e){return e.getEstimatedTime()})).unwrap()}function q(e){return y().fmap(u.maybe,(function(t){var n=new chrome.cast.media.SeekRequest;return n.currentTime=e,t.seek(n)})),e}function G(){return y().fmap(u.maybe,(function(e){return e.play()})).unwrap()}function F(){return y().fmap(u.maybe,(function(e){return e.pause()})).unwrap()}var B=Object.freeze({__proto__:null,load:j,has_media:P,exists:M,device_name:function(){return d().fmap(u.maybe,(function(e){return e.getCastDevice().friendlyName})).unwrap()},duration:R,state:H,currentTime:U,seek:q,play:G,pause:F});function Y(e){this.video=e}function z(){}Y.of=function(e){return e.sender||(e.sender=new Y(e)),e.sender},Y.maybe=function(e,t){e.sender&&t(e.sender,e)},Y.getEstimatedTime=function(){return y().fmap(u.maybe,(function(e){return e.getEstimatedTime()})).unwrap()},Y.load=function(e){j(e,console.debug,console.error)},Y.destroy=function(e){e.video=0};var V=Object.freeze({__proto__:null,STABLE:"940D4BE4",CANARY:"6F71FA7C",LOCAL:"5258CA32"}),J="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";function W(e,n){if(document.querySelector("script[src='"+J+"']"))return X();var r,a,o,i;r=J,o=document.getElementsByTagName("head")[0],(i=document.createElement("script")).src=r,i.onload=i.onerror=a||z,o.appendChild(i),window.__onGCastApiAvailable=function(){!function(e,n){if(!Q())return;var r=t(e,"chromecast.app","940D4BE4");E().fmap(u.maybe,(function(e){e.setOptions({receiverApplicationId:r,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,(function(e){A("chromecast:state:changed",e)})),e.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,(function(e){L(),A("chromecast:session:changed",e)}))}))}(e),X()}}function Q(){return"object"==typeof window.cast&&"object"==typeof chrome.cast}function X(){if(Q())return A("chromecast:available");A("chromecast:unavailable")}var K="is-chromecast-playing";const Z=!!function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,t),window.removeEventListener("testPassive",null,t)}catch(e){}return e}()&&{passive:!0},$=["touchstart","touchmove"];function ee(e){var t=e;return t.emit=function(e,n,r={}){const a=function(e){const t=document.createEvent("Event");return t.initEvent(e,!1,!0),t}(e);return n&&function(e,t,...n){for(const n in t)e[n]=t[n]}(a,{data:n||{}}),t.dispatchEvent(a),!1===r.return_self?a:t},t.on=function(e,n){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(e){return~$.indexOf(e)}(e)?t.addEventListener(e,n,Z):t.addEventListener(e,n)})),t},t.off=function(e,n){return t.removeEventListener(e,n),t},t.one=t.once=function(e,n){return t.on(e,(function r(a){t.off(e,r),n(a)}))},t}const te=Array.isArray,ne="undefined"!=typeof window&&ee(window),re="undefined"!=typeof document&&ee(document),ae=["span","a","em","p","i"];function oe(e,t,n){var r=ce(document.createElement(e));if(te(t)&&(n=t,t=!1),n||(n=[]),n&&!te(n)&&(n=[n]),n.length&&n.filter(e=>!!e).forEach(e=>r.append(e)),"object"!=typeof t)return r;for(var a in t)a in r?r[a]=t[a]:r.setAttribute(a,t[a]);return r}function ie(t){var n=t.tagName;t.__flowplayer__=1,t.find=function(e){var n=t.querySelector(e);return n?ce(n):n},t.html=function(e){return t.innerHTML=e,t},t.empty=function(){return t.innerHTML="",t},t.offset=function(){var e={top:0,left:0},n=t;do{e.left+=n.offsetLeft||0,e.top+=n.offsetTop||0}while(n=n.offsetParent);return e},t.innerWidth=function(){var e=getComputedStyle(t);return t.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=t.insert=function(e,n){return n?te(n)?n.map((function(n){return t.insert(e,n)}))[0]:ce(n="string"==typeof n?t.insertAdjacentHTML(e,n):t.insertAdjacentElement?t.insertAdjacentElement(e,n):t.appendChild(n)):n};return t.append=r.bind(t,"beforeend"),t.prepend=r.bind(t,"afterbegin"),t.css=function(e,n){if("object"==typeof e){for(const n in e)t.css(n,e[n]);return t}return void 0===n&&"string"==typeof e?getComputedStyle(t)[e]:("number"==typeof n&&(n+="px"),t.style[e]=n,t)},t.show=function(){return t.css({display:~ae.indexOf(n)?"inline":"block"})},t.hide=function(){return t.css({display:"none"})},t.remove=function(){var e=t.parentNode;e&&e.removeChild(t)},t.attr=function(e,n){return null==n?t.getAttribute(e):(t.setAttribute(e,n),t)},t.txt=function(e){return t.textContent=e,t},t.fp=function(e){return t.addClass("fp-"+e)},t.addClass=function(e){return e.split(" ").forEach((function(e){t.hasClass(e)||(t.className+=(t.className?" ":"")+e)})),t},t.removeClass=function(e){const n=e.split(" ");var r=t.className.split(" ");return t.className=r.filter((function(e){return!~n.indexOf(e)})).join(" "),t},t.toggleClass=function(e,n){return void 0===n&&(n=!t.hasClass(e)),n?t.addClass(e):t.removeClass(e)},t.findAll=function(n){return r=t.querySelectorAll(n),e.call(r);var r},t.hasClass=function(e){return~t.className.split(" ").indexOf(e)},t}function ce(e){return void 0===e||function(e){return e&&e.__flowplayer__}(e)?e:ie(ee(e))}function se(e,t){if("string"==typeof e&&"<"==e[0])return oe(e.slice(1,-1),t);if("string"!=typeof e)return ce(e);var n=t instanceof HTMLElement&&t.querySelector(".fp-"+e)||document.querySelector(e);return n?ce(n):void 0}const ue=e=>(t,n)=>("string"==typeof t&&(t={class:t}),oe(e,t,n));Object.assign(se,{div:ue("div"),img:ue("img"),li:ue("li"),ol:ue("ol"),span:ue("span"),p:ue("p"),i:ue("i"),a:ue("a"),el:oe,document:re,window:ne});function fe(e,t){var n={play:function(){return v(t)?G():P()?Y.load(t):void Y.load(t)},pause:function(){return v(t)?F():HTMLMediaElement.prototype.pause.call(t)}};n.currentTime={get:U,set:U},n.duration={get:R},n.paused={get:function(){return"PAUSED"===H()}},n.playing={get:function(){return"PLAYING"===H()}},Object.keys(n).forEach((function(e){if("object"==typeof n[e])return Object.defineProperty(t,e,{get:function(){return v(t)?n[e].get():Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,e).get.call(this)},set:function(r){return v(t)?n[e].set(r):Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,e).set.call(this,r)}});var r=t[e];t[e]=function(){var t=[].slice.apply(arguments);return M()?n[e].apply(this,t):r.apply(this,t)}}))}function le(e,n,r){if("https:"!==location.protocol&&"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname)return console.warn("Secure URL required to enable Chromecast");W(e);var a={pending:void 0};r.on("reap",(function(){Y.maybe(r,Y.destroy)})),r.on("mount",(function(){var a,o,i,c,s=t(n,"middle");s&&(a=s,o={poster:e.poster},i=se.div("fp-chromecast"),c=se.el("p"),o.poster&&(i.style.backgroundImage=["url(",o.poster,")"].join("")),i.append(c),a.prepend(i));var u=t(n,"ui.header.secondary");u&&function(e,t){var n=se.el("span").addClass("fp-cast-button");n.append(se.el("google-cast-launcher")),e.prepend(n),n.on("click",(function(){const e=d().unwrap();if(e)return e.endSession(!0);t.emit("chromecast:start")}))}(u,r)})),r.on("chromecast:available",(function(){r.setState("is-cast-available",!0),Y.of(r),fe(r.sender,r)})),r.on("chromecast:unavailable",(function(){r.setState("is-cast-available",!1),Y.maybe(r,Y.destroy)})),r.on("chromecast:start",(function(){if(P())return Y.load(r);a.pending=!0})),r.on("tracks:text:updated",(function(e){if(P())return e.data?void x(k(r).map((function(e,t){return{track:e.track,id:t}})).filter((function(t){return t.track==e.data})).map((function(e){return e.id}))):x([])})),r.on(f,(function(){r.setState(K,!1),r.setState("is-starting",!0)})),r.on("chromecast:field:update",(function(e){var n=t(e,"data.field"),a=t(e,"data.value");switch(n){case C.CURRENT_TIME:return r.emit("timeupdate",a);case C.PLAYER_STATE:return"PLAYING"==a?r.emit("playing"):"PAUSED"==a?r.emit("pause"):void 0;case"mediaInfo":var o=(a||{}).fake_session||B;return function(e,n){if(0!=e.root){var r=e.root.querySelector(".fp-chromecast p");if(r){var a="";a=(a=e._t("chromecast.message","{{state}} on {{device}}").replace("{{device}}",t(n,"device","chromecast"))).replace("{{state}}",t(n,"state","").toLowerCase()),r.txt(a)}}}(r,{device:o.device_name(),state:o.state()}),o.hide_controls&&r.setState("no-chromecast-controls",!0),r.setState("is-starting",!1),r.setState(K,!0)}})),r.on("chromecast:session:changed",(function(e){switch(t(e,"data.sessionState")){case cast.framework.SessionState.SESSION_ENDED:return r.setState(K,!1);case cast.framework.SessionState.SESSION_RESUMED:case cast.framework.SessionState.SESSION_STARTED:a.pending&&(a.pending=!1,Y.load(r))}}))}return window.CastSession=B,window.CastUtils=D,le.apps=V,le.events=l,function(e,t){if("object"==typeof exports&&"undefined"!=typeof module)return t;"flowplayer"in e||(e.flowplayer={extensions:[]});var n=e.flowplayer;return"function"==typeof n?(n(t),t):(Array.isArray(n.extensions)||(n.extensions=[]),~n.extensions.indexOf(t)||n.extensions.push(t),t)}(window,le)}));

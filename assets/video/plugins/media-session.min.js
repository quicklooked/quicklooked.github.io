!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.media_session=n())}(this,(function(){"use strict";function e(e,n,t){const i=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(n);for(;i.length;){if(null==e)return t;const n=i.shift();if("string"!=typeof n)return t;e=e[n]}return null==e?t:e}var n=void 0;function t(e,t){e.enqueueSeek(t)&&function(e){e.setState("is-kb-active",!0),clearTimeout(n),n=setTimeout((function(){e.setState("is-kb-active",!1)}),2500)}(e)}var i="playlist:next";const a="pause",o="playing",s="seeked";var r=function(e){const n={val:e};return function(e){return void 0!==e&&(n.val=e),n.val}}();function l(e){u(e.data)}function u(n){var t=e(n,"media_session",{});if("title"in t||(t.title=e(n,"title")),!("artwork"in t)){var i="poster"in n?e(n,"poster"):"";t.artwork=[{src:i,sizes:"512x512"},{src:i,sizes:"256x256"}]}navigator.mediaSession.metadata=new MediaMetadata(t)}function f(){if("setPositionState"in navigator.mediaSession){var e=r();navigator.mediaSession.setPositionState({duration:Math.round(e.duration||0),playbackRate:e.hasState("is-playing")?e.playbackRate:.001,position:Math.round(e.currentTime)}),navigator.mediaSession.playbackState=e.hasState("is-playing")?"playing":"paused"}}return function(e,n){if("object"==typeof exports&&"undefined"!=typeof module)return n;"flowplayer"in e||(e.flowplayer={extensions:[]});var t=e.flowplayer;return"function"==typeof t?(t(n),n):(Array.isArray(t.extensions)||(t.extensions=[]),~t.extensions.indexOf(n)||t.extensions.push(n),n)}(window,(function(n,c,d){"mediaSession"in navigator&&d.on(["loadstart",o,"fullscreenenter"],(function(){var n=r();d!==n&&(n&&(["ratechange",s,o,a].forEach((function(e){n.off(e,f)})),n.off(i,l),n=null),r(d),u(d.opts),function(){var n=r();navigator.mediaSession.setActionHandler("play",(function(){n.togglePlay()})),navigator.mediaSession.setActionHandler("pause",(function(){n.togglePlay()})),n.playlist&&(navigator.mediaSession.setActionHandler("nexttrack",(function(){n.playlist.next()})),navigator.mediaSession.setActionHandler("previoustrack",(function(){n.playlist.prev()})));!function(n){if(!e(n,"opts.seekable",!0)||n.hasState("no-timeline"))return;e(n,"opts.media_session.seek_step",.15),n.disabled||navigator.mediaSession.setActionHandler("seekforward",(function(){t(n,!0)}));navigator.mediaSession.setActionHandler("seekbackward",(function(){t(n,!1)}));try{navigator.mediaSession.setActionHandler("seekto",(function(e){e.seekTime>n.currentTime&&n.disabled?f():e.seekTime<n.duration&&(n.currentTime=e.seekTime)}))}catch(e){}}(n)}(),f(),d.on(["ratechange",s,o,a],f),d.on(i,l))}))}))}));

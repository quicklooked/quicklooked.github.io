!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((e="undefined"!=typeof globalThis?globalThis:e||self).flowplayer=e.flowplayer||{},e.flowplayer.qul=n())}(this,(function(){"use strict";const e=[].slice;function n(e,n,t){const r=function(e){return Array.isArray(e)?e.slice(0):e.split(".")}(n);for(;r.length;){if(null==e)return t;const n=r.shift();if("string"!=typeof n)return t;e=e[n]}return null==e?t:e}const t=!!function(){let e=!1;try{const n=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassive",null,n),window.removeEventListener("testPassive",null,n)}catch(e){}return e}()&&{passive:!0},r=["touchstart","touchmove"];function o(e){var n=e;return n.emit=function(e,t,r={}){const o=function(e){const n=document.createEvent("Event");return n.initEvent(e,!1,!0),n}(e);return t&&function(e,n,...t){for(const t in n)e[t]=n[t]}(o,{data:t||{}}),n.dispatchEvent(o),!1===r.return_self?o:n},n.on=function(e,o){return"string"==typeof e&&(e=e.split(" ")),e.forEach((function(e){return function(e){return~r.indexOf(e)}(e)?n.addEventListener(e,o,t):n.addEventListener(e,o)})),n},n.off=function(e,t){return n.removeEventListener(e,t),n},n.one=n.once=function(e,t){return n.on(e,(function r(o){n.off(e,r),t(o)}))},n}const i=Array.isArray,a="undefined"!=typeof window&&o(window),s="undefined"!=typeof document&&o(document),u=["span","a","em","p","i"];function c(e,n,t){var r=d(document.createElement(e));if(i(n)&&(t=n,n=!1),t||(t=[]),t&&!i(t)&&(t=[t]),t.length&&t.filter(e=>!!e).forEach(e=>r.append(e)),"object"!=typeof n)return r;for(var o in n)o in r?r[o]=n[o]:r.setAttribute(o,n[o]);return r}function f(n){var t=n.tagName;n.__flowplayer__=1,n.find=function(e){var t=n.querySelector(e);return t?d(t):t},n.html=function(e){return n.innerHTML=e,n},n.empty=function(){return n.innerHTML="",n},n.offset=function(){var e={top:0,left:0},t=n;do{e.left+=t.offsetLeft||0,e.top+=t.offsetTop||0}while(t=t.offsetParent);return e},n.innerWidth=function(){var e=getComputedStyle(n);return n.clientWidth-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)};var r=n.insert=function(e,t){return t?i(t)?t.map((function(t){return n.insert(e,t)}))[0]:d(t="string"==typeof t?n.insertAdjacentHTML(e,t):n.insertAdjacentElement?n.insertAdjacentElement(e,t):n.appendChild(t)):t};return n.append=r.bind(n,"beforeend"),n.prepend=r.bind(n,"afterbegin"),n.css=function(e,t){if("object"==typeof e){for(const t in e)n.css(t,e[t]);return n}return void 0===t&&"string"==typeof e?getComputedStyle(n)[e]:("number"==typeof t&&(t+="px"),n.style[e]=t,n)},n.show=function(){return n.css({display:~u.indexOf(t)?"inline":"block"})},n.hide=function(){return n.css({display:"none"})},n.remove=function(){var e=n.parentNode;e&&e.removeChild(n)},n.attr=function(e,t){return null==t?n.getAttribute(e):(n.setAttribute(e,t),n)},n.txt=function(e){return n.textContent=e,n},n.fp=function(e){return n.addClass("fp-"+e)},n.addClass=function(e){return e.split(" ").forEach((function(e){n.hasClass(e)||(n.className+=(n.className?" ":"")+e)})),n},n.removeClass=function(e){const t=e.split(" ");var r=n.className.split(" ");return n.className=r.filter((function(e){return!~t.indexOf(e)})).join(" "),n},n.toggleClass=function(e,t){return void 0===t&&(t=!n.hasClass(e)),t?n.addClass(e):n.removeClass(e)},n.findAll=function(t){return r=n.querySelectorAll(t),e.call(r);var r},n.hasClass=function(e){return~n.className.split(" ").indexOf(e)},n}function d(e){return void 0===e||function(e){return e&&e.__flowplayer__}(e)?e:f(o(e))}function l(e,n){if("string"==typeof e&&"<"==e[0])return c(e.slice(1,-1),n);if("string"!=typeof e)return d(e);var t=n instanceof HTMLElement&&n.querySelector(".fp-"+e)||document.querySelector(e);return t?d(t):void 0}const p=e=>(n,t)=>("string"==typeof n&&(n={class:n}),c(e,n,t));Object.assign(l,{div:p("div"),img:p("img"),li:p("li"),ol:p("ol"),span:p("span"),p:p("p"),i:p("i"),a:p("a"),el:c,document:s,window:a});function v(e,n){try{var t=n.exec(e)[1];return parseFloat(t,10)}catch(e){return console.error(e),0}}function m(e){return e=e||{},void 0===window.MediaSource&&void 0===window.WebKitMediaSource||(t="undefined"!=typeof document&&"undefined"!=typeof window,r=t?navigator.userAgent:"",o=/iP(hone|od)/i.test(r)&&!/iPad/.test(r)&&!/IEMobile/i.test(r),i=/Android/.test(r)&&!/Firefox/.test(r),a=/IEMobile/.test(r),s=a?v(r,/Windows Phone (\d+\.\d+)/):0,u=a?v(r,/IEMobile\/(\d+\.\d+)/):0,c=/^((?!chrome|android).)*safari/i.test(r),f=/SamsungBrowser/.test(r),d=f&&/SMART-TV/.test(r),l=o&&/FBSN\/iOS/i.test(r),p=function(){if(!t)return!1;if(document.documentMode)return document.documentMode;for(var e=9;e>3;e--){var n=document.createElement("div");if(n.innerHTML="\x3c!--[if IE "+e+"]><span></span><![endif]--\x3e",n.getElementsByTagName("span").length)return e}return!1}(),{controls:!o&&(!a||s>=8.1&&u>=11),video:function(e){return t&&document.createElement("video").canPlayType(e)},lang:t&&(window.navigator.userLanguage||window.navigator.language),android:i,iphone:o,ie:p,safari:c,ios:t&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,samsung:f,samsung_tv:f&&d,fb_ios:l}).video("application/vnd.apple.mpegURL")&&n(e,"hls.native",!1);var t,r,o,i,a,s,u,c,f,d,l,p}function y(e,n){n.id&&clearInterval(n.id)}function g(e,n){h(e.original_src,(function(t,r,o){if(200!=r)return y(0,n),t?e.emit("error",t):e.emit("error",{code:r,resp:o})}))}function h(e,n){var t=new XMLHttpRequest;t.onload=function(){if(200==t.status)return n(null,t.status);try{var e=JSON.parse(t.responseText);n(null,"qul:"+t.status,e)}catch(e){n(e)}},t.open("GET",function(e){var n=document.createElement("a");n.href=e;var t="bust="+Date.now();return[n.protocol,"//",n.hostname,n.pathname,n.search,n.search.length?"&":"?",t].join("")}(e)),t.send()}function w(e,n,t){var r=document.createElement("a");r.href=e;var o=encodeURIComponent(n);return t&&(o+="/dId:"+encodeURIComponent(t)),[r.protocol,"//",r.hostname,r.pathname.replace(b(r.pathname,0),o+"/"+b(r.pathname,0))].join("")}function E(e,t,r){var o,i=n(e,"qul.token"),a=n(e,"qul.device_id",n(e,"qul.dId")),s={};r.on("src",(function(t){o=n(t.data,"src"),y(0,s),"string"==typeof o&&o.match(/\.m3u8$/)&&i&&(t.data.src=w(o,i,a),m(e)&&(s=function(e,t){var r={id:void 0,interval:Math.min(2e4,n(t,"qul.interval",2e4))};return e.one("reap",(function(){y(0,r)})),setInterval(g,r.interval,e,r),setTimeout(g,0,e,r),r}(r,r.opts)))})),r.on("config",(function(e){var t=n(e.data,"qul.token"),a=n(e.data,"qul.device_id",n(e.data,"qul.dId"));t&&t!==i&&function(e,n){i=e,r.setSrc({type:"application/x-mpegurl",src:w(o,i,n)})}(i,a)})),r.on("error",(function(e){var o=n(e,"data.code","").toString();if(o.match(/^(qul|http)/)){y(0,s),e.preventDefault(),r.setState("is-error",!0);var i=n(e,"data.resp");if(i)return x(r,t.ui,i,o);h(r.original_src,(function(e,n,o){if(e)return r.emit("error",e);!isNaN(n)&&n<400||x(r,t.ui,o,n)}))}}))}function x(e,n,t,r){var o=t.message||"an error occurred during this session",i=t.key?e._t(t.key,o):o;e.pause(),e.emit("qul:error",{code:r,resp:t},{return_self:!1}).defaultPrevented||function(e,n,t,r){if(e){var o=l.div("fp-error").txt(n);if(r){var i=e.querySelector("#"+r);i&&e.removeChild(i),o.id=r}e.append(o),t&&o.append(l.div("fp-error-details").txt(t))}}(n,i,!1,"qul_error")}function b(e,n){return e.split("/").reverse().slice(0,n+1).reverse().join("/")}return function(e,n){if("object"==typeof exports&&"undefined"!=typeof module)return n;"flowplayer"in e||(e.flowplayer={extensions:[]});var t=e.flowplayer;"function"==typeof t?t(n):(Array.isArray(t.extensions)||(t.extensions=[]),~t.extensions.indexOf(n)||t.extensions.push(n))}(window,E),E.events={QUL_ERROR:"qul:error"},E}));
